<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.8.3" />
<title>project.esn.updater API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>project.esn.updater</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from pprint import pprint as p

import numpy as np
import project.esn.matrix as m
from project.esn import utils as u


def apply_leak(state, update, leaking_rate=0.3):
    &#34;&#34;&#34;Simple leaking formula which returns the new state from the next
state and the previous one scaling both by the leaking rate and
1-leaking rate

    &#34;&#34;&#34;
    return (update * leaking_rate) + (state * (1 - leaking_rate))


@u.mydataclass(repr=True, init=True, check=False)
class Updator():
    &#34;&#34;&#34;Updator data class This class manage the update process and all
    the weights involved in it It also store the last state in other
    to use it in the next update
    &#34;&#34;&#34;


    _next: callable = None
    &#34;&#34;&#34; The update function used to calculate the next state &#34;&#34;&#34;

    weights: m.Esn_matrixs = None
    &#34;&#34;&#34;The class which wraps all the matrixs involved in the ESN&#34;&#34;&#34;

    state: np.ndarray = None
    &#34;&#34;&#34;The current state of the network (it will be updated at each
iteration)&#34;&#34;&#34;

    squeeze_f: callable = np.tanh
    &#34;&#34;&#34;The squeezing function applied to the result of the the _next
function&#34;&#34;&#34;

    squeeze_o: callable = lambda x: x
    &#34;&#34;&#34;The squeezing function applied to the result of the output
function&#34;&#34;&#34;

    leaking_rate: float = 0.3
    &#34;&#34;&#34;The leaking rate used to calculate the _next state&#34;&#34;&#34;

    noise: float = 0.0
    &#34;&#34;&#34;The noise which is added to the result of the _next function&#34;&#34;&#34;

    def __post_init__(self):
        &#34;&#34;&#34;Enrich the specified _next function. It adds the noise and squeeze
the final output after calling the _next function&#34;&#34;&#34;
        self._next = u.comp(self.squeeze_f, lambda x: x + self.noise,
                            self._next)

    def __call__(self, other):
        &#34;&#34;&#34;calculate the next state from a tuple(other) which is composed by
the input and possibly an output

        &#34;&#34;&#34;
        next_state = self._next(self.weights, self.state, other)
        self.state = apply_leak(self.state, next_state, self.leaking_rate)
        return self.state

    def __lshift__(self, other):
        &#34;&#34;&#34;reflect the __call__ function

        &#34;&#34;&#34;
        return self.__call__(other)

    def __rshift__(self, other):
        &#34;&#34;&#34;calculate the output of the network given an input (other)&#34;&#34;&#34;
        return default_output(self.weights.W_out, self.state, other,
                              self.squeeze_o)


def def_updator(fun):
    &#34;&#34;&#34;Decorator which define a new updater
    &#34;&#34;&#34;
    def inner(*args, **kwargs):
        return Updator(fun, *args, **kwargs)
    return inner



@def_updator
@u.pre_proc_args({
    &#34;state&#34;:
    u.force_2dim,
    &#34;tuple&#34;:
    lambda tuple: (u.force_2dim(tuple[0]), u.force_2dim(tuple[1]))
})
def vanilla_updator(weights: m.Esn_matrixs, state, tuple):
    &#34;&#34;&#34;This calculate the next state using the standard update formula
    \(1+1 \)

    &#34;&#34;&#34;
    (input, _) = tuple
    return weights.W_in.dot(input) + weights.W_res.dot(state)


@def_updator
@u.pre_proc_args({
    &#34;state&#34;:
    u.force_2dim,
    &#34;tuple&#34;:
    lambda tuple: (u.force_2dim(tuple[0]), u.force_2dim(tuple[1]))
})
def feedback_updator(weights: m.Esn_matrixs, state, tuple):
    &#34;&#34;&#34;This function calculate the next state given an input and an output
using the enhanced formula

    &#34;&#34;&#34;
    (input, output) = tuple
    return ((weights.W_in * input) + (weights.W_res * state) +
            (weights.W_feb * output))


@u.pre_proc_args({&#34;input&#34;: u.force_2dim, &#34;state&#34;: u.force_2dim})
def default_output(W_out, state, input, output_f=lambda x: x):
    &#34;&#34;&#34;calculate the output using the standard formula

    &#34;&#34;&#34;
    z_n = m.build_extended_states(input.T, state.T).T
    return output_f(W_out.dot(z_n)).reshape(-1)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="project.esn.updater.apply_leak"><code class="name flex">
<span>def <span class="ident">apply_leak</span></span>(<span>state, update, leaking_rate=0.3)</span>
</code></dt>
<dd>
<div class="desc"><p>Simple leaking formula which returns the new state from the next
state and the previous one scaling both by the leaking rate and
1-leaking rate</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def apply_leak(state, update, leaking_rate=0.3):
    &#34;&#34;&#34;Simple leaking formula which returns the new state from the next
state and the previous one scaling both by the leaking rate and
1-leaking rate

    &#34;&#34;&#34;
    return (update * leaking_rate) + (state * (1 - leaking_rate))</code></pre>
</details>
</dd>
<dt id="project.esn.updater.def_updator"><code class="name flex">
<span>def <span class="ident">def_updator</span></span>(<span>fun)</span>
</code></dt>
<dd>
<div class="desc"><p>Decorator which define a new updater</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def def_updator(fun):
    &#34;&#34;&#34;Decorator which define a new updater
    &#34;&#34;&#34;
    def inner(*args, **kwargs):
        return Updator(fun, *args, **kwargs)
    return inner</code></pre>
</details>
</dd>
<dt id="project.esn.updater.default_output"><code class="name flex">
<span>def <span class="ident">default_output</span></span>(<span>W_out, state, input, output_f=&lt;function &lt;lambda&gt;&gt;)</span>
</code></dt>
<dd>
<div class="desc"><p>calculate the output using the standard formula</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@u.pre_proc_args({&#34;input&#34;: u.force_2dim, &#34;state&#34;: u.force_2dim})
def default_output(W_out, state, input, output_f=lambda x: x):
    &#34;&#34;&#34;calculate the output using the standard formula

    &#34;&#34;&#34;
    z_n = m.build_extended_states(input.T, state.T).T
    return output_f(W_out.dot(z_n)).reshape(-1)</code></pre>
</details>
</dd>
<dt id="project.esn.updater.feedback_updator"><code class="name flex">
<span>def <span class="ident">feedback_updator</span></span>(<span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def inner(*args, **kwargs):
    return Updator(fun, *args, **kwargs)</code></pre>
</details>
</dd>
<dt id="project.esn.updater.vanilla_updator"><code class="name flex">
<span>def <span class="ident">vanilla_updator</span></span>(<span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def inner(*args, **kwargs):
    return Updator(fun, *args, **kwargs)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="project.esn.updater.Updator"><code class="flex name class">
<span>class <span class="ident">Updator</span></span>
<span>(</span><span>weights: <a title="project.esn.matrix.Esn_matrixs" href="matrix.html#project.esn.matrix.Esn_matrixs">Esn_matrixs</a> = None, state: numpy.ndarray = None, squeeze_f: <built-in function callable> = &lt;ufunc &#x27;tanh&#x27;&gt;, squeeze_o: <built-in function callable> = &lt;function Updator.&lt;lambda&gt;&gt;, leaking_rate: float = 0.3, noise: float = 0.0)</span>
</code></dt>
<dd>
<div class="desc"><p>Updator data class This class manage the update process and all
the weights involved in it It also store the last state in other
to use it in the next update</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Updator():
    &#34;&#34;&#34;Updator data class This class manage the update process and all
    the weights involved in it It also store the last state in other
    to use it in the next update
    &#34;&#34;&#34;


    _next: callable = None
    &#34;&#34;&#34; The update function used to calculate the next state &#34;&#34;&#34;

    weights: m.Esn_matrixs = None
    &#34;&#34;&#34;The class which wraps all the matrixs involved in the ESN&#34;&#34;&#34;

    state: np.ndarray = None
    &#34;&#34;&#34;The current state of the network (it will be updated at each
iteration)&#34;&#34;&#34;

    squeeze_f: callable = np.tanh
    &#34;&#34;&#34;The squeezing function applied to the result of the the _next
function&#34;&#34;&#34;

    squeeze_o: callable = lambda x: x
    &#34;&#34;&#34;The squeezing function applied to the result of the output
function&#34;&#34;&#34;

    leaking_rate: float = 0.3
    &#34;&#34;&#34;The leaking rate used to calculate the _next state&#34;&#34;&#34;

    noise: float = 0.0
    &#34;&#34;&#34;The noise which is added to the result of the _next function&#34;&#34;&#34;

    def __post_init__(self):
        &#34;&#34;&#34;Enrich the specified _next function. It adds the noise and squeeze
the final output after calling the _next function&#34;&#34;&#34;
        self._next = u.comp(self.squeeze_f, lambda x: x + self.noise,
                            self._next)

    def __call__(self, other):
        &#34;&#34;&#34;calculate the next state from a tuple(other) which is composed by
the input and possibly an output

        &#34;&#34;&#34;
        next_state = self._next(self.weights, self.state, other)
        self.state = apply_leak(self.state, next_state, self.leaking_rate)
        return self.state

    def __lshift__(self, other):
        &#34;&#34;&#34;reflect the __call__ function

        &#34;&#34;&#34;
        return self.__call__(other)

    def __rshift__(self, other):
        &#34;&#34;&#34;calculate the output of the network given an input (other)&#34;&#34;&#34;
        return default_output(self.weights.W_out, self.state, other,
                              self.squeeze_o)</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="project.esn.updater.Updator.leaking_rate"><code class="name">var <span class="ident">leaking_rate</span> : float</code></dt>
<dd>
<div class="desc"><p>The leaking rate used to calculate the _next state</p></div>
</dd>
<dt id="project.esn.updater.Updator.noise"><code class="name">var <span class="ident">noise</span> : float</code></dt>
<dd>
<div class="desc"><p>The noise which is added to the result of the _next function</p></div>
</dd>
<dt id="project.esn.updater.Updator.squeeze_f"><code class="name">var <span class="ident">squeeze_f</span> : <built-in function callable></code></dt>
<dd>
<div class="desc"><p>The squeezing function applied to the result of the the _next
function</p></div>
</dd>
<dt id="project.esn.updater.Updator.state"><code class="name">var <span class="ident">state</span> : numpy.ndarray</code></dt>
<dd>
<div class="desc"><p>The current state of the network (it will be updated at each
iteration)</p></div>
</dd>
<dt id="project.esn.updater.Updator.weights"><code class="name">var <span class="ident">weights</span> : <a title="project.esn.matrix.Esn_matrixs" href="matrix.html#project.esn.matrix.Esn_matrixs">Esn_matrixs</a></code></dt>
<dd>
<div class="desc"><p>The class which wraps all the matrixs involved in the ESN</p></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="project.esn.updater.Updator.squeeze_o"><code class="name flex">
<span>def <span class="ident">squeeze_o</span></span>(<span>x) ‑> <built-in function callable></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">squeeze_o: callable = lambda x: x</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="project.esn" href="index.html">project.esn</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="project.esn.updater.apply_leak" href="#project.esn.updater.apply_leak">apply_leak</a></code></li>
<li><code><a title="project.esn.updater.def_updator" href="#project.esn.updater.def_updator">def_updator</a></code></li>
<li><code><a title="project.esn.updater.default_output" href="#project.esn.updater.default_output">default_output</a></code></li>
<li><code><a title="project.esn.updater.feedback_updator" href="#project.esn.updater.feedback_updator">feedback_updator</a></code></li>
<li><code><a title="project.esn.updater.vanilla_updator" href="#project.esn.updater.vanilla_updator">vanilla_updator</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="project.esn.updater.Updator" href="#project.esn.updater.Updator">Updator</a></code></h4>
<ul class="two-column">
<li><code><a title="project.esn.updater.Updator.leaking_rate" href="#project.esn.updater.Updator.leaking_rate">leaking_rate</a></code></li>
<li><code><a title="project.esn.updater.Updator.noise" href="#project.esn.updater.Updator.noise">noise</a></code></li>
<li><code><a title="project.esn.updater.Updator.squeeze_f" href="#project.esn.updater.Updator.squeeze_f">squeeze_f</a></code></li>
<li><code><a title="project.esn.updater.Updator.squeeze_o" href="#project.esn.updater.Updator.squeeze_o">squeeze_o</a></code></li>
<li><code><a title="project.esn.updater.Updator.state" href="#project.esn.updater.Updator.state">state</a></code></li>
<li><code><a title="project.esn.updater.Updator.weights" href="#project.esn.updater.Updator.weights">weights</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.8.3</a>.</p>
</footer>
</body>
</html>